import { createContext } from 'react';
import { ReducerRegistry, applyReducerHash } from '@redhat-cloud-services/frontend-components-utilities/ReducerRegistry';
import promiseMiddleware from 'redux-promise-middleware';

export const RegistryContext = createContext({
    getRegistry: () => {}
});

export function init (...middleware) {
    return new ReducerRegistry(
        {},
        [
            promiseMiddleware,
            ...middleware
        ]
    );
}

const selectRows = (rows, selected) =>
    rows.map((row) => ({
        ...row,
        selected: selected.includes(row.id)
    }));

export const entitiesReducer = () =>
    applyReducerHash({
        ['INVENTORY_INIT']: () => ({
            rows: [],
            total: 0
        }),
        ['RESET_PAGE']: (state) => ({
            ...state,
            page: 1
        }),
        ['SELECT_ENTITIES']: (state, { payload: { selected } }) => ({
            ...state,
            rows: selectRows(state.rows || [], selected)
        })
    });
