import React from 'react';
import { BrowserRouter as Router } from 'react-router-dom';
import { render, screen } from '@testing-library/react';
import { IntlProvider } from 'react-intl';
import { useQuery } from '@apollo/client';
import '@testing-library/jest-dom';

import NewSigDetailsTable from '../NewSigDetailsTable';

jest.mock('@apollo/client');
jest.mock('@unleash/proxy-client-react', () => ({
  ...jest.requireActual('@unleash/proxy-client-react'),
  useFlag: () => true,
  useFlagsStatus: () => ({ flagsReady: true }),
}));

describe('SigDetailsTable', () => {
  beforeEach(() => {
    useQuery.mockImplementation(() => ({
      data: {
        rulesList: [
          {
            affectedHostsList: [
              {
                id: 'e6d39d55-6420-47f4-a1d3-cf6fa4df419a',
                displayName:
                  'iqe-advisor-0b1a99be-8cd4-4168-9675-cfed8a0ac4ef.test',
                groups: [],
                osVersion: '8.0',
                lastScanDate: '2024-07-04T04:08:36.178559+00:00',
                matchCount: '1',
                matches: [
                  {
                    scanDate: '2024-07-04T04:08:36.178559+00:00',
                    ruleScanId: 135163,
                    ruleId: 2,
                    hostId: 'e6d39d55-6420-47f4-a1d3-cf6fa4df419a',
                    id: 279881,
                  },
                ],
                newMatchCount: '1',
              },
              {
                id: 'e3782507-bba7-4050-92dc-b1c222241cf5',
                displayName:
                  'iqe-advisor-74162087-5393-4434-8574-10503cd95323.test',
                groups: [
                  {
                    id: 'dd960970-7ce1-4272-9133-7b145d648ddf',
                    name: '381testAAAAA',
                  },
                ],
                osVersion: '8.0',
                lastScanDate: '2024-06-27T16:22:00.800144+00:00',
                matchCount: '1',
                matches: [
                  {
                    scanDate: '2024-06-27T16:22:00.800144+00:00',
                    ruleScanId: 134469,
                    ruleId: 2,
                    hostId: 'e3782507-bba7-4050-92dc-b1c222241cf5',
                  },
                ],
              },
            ],
            affectedHosts: {
              totalCount: 2,
            },
          },
        ],
      },
      loading: false,
      error: {},
    }));
  });

  it.skip('should render SigDetailsTable', async () => {
    render(
      <IntlProvider locale="en">
        <Router>
          <NewSigDetailsTable />
        </Router>
      </IntlProvider>
    );

    expect(
      screen.getByRole('button', {
        name: /new matches/i,
      })
    ).toBeVisible();
  });
});
