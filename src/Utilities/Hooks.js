import { useFlag, useFlagsStatus } from '@unleash/proxy-client-react';
import { useMutation } from '@apollo/client';
import { DELETE_MATCH } from '../operations/mutations';

export const useFeatureFlag = (flag) => {
  const { flagsReady } = useFlagsStatus();
  const isFlagEnabled = useFlag(flag);
  return flagsReady ? isFlagEnabled : undefined;
};

export const useWorkspaceFeatureFlag = () =>
  useFeatureFlag('platform.rbac.groups-to-workspaces-rename');

export const useNewMatchesFeatureFlag = () =>
  useFeatureFlag('insights.malware.matches');

export const useActionsConfig = (
  isWriteAccessLoading,
  hasWriteAccess,
  selectedMatches,
  setSelectedMatches,
  fetchDetailsTable,
  fetchDetailsTableGroups
) => {
  const [deleteMatch] = useMutation(DELETE_MATCH);

  return [
    '',
    {
      label: 'Delete matches',
      props: { isDisabled: !isWriteAccessLoading && !hasWriteAccess },
      onClick: async () => {
        try {
          await deleteMatch({
            variables: {
              input: selectedMatches,
            },
          });
          setSelectedMatches([]);
          fetchDetailsTable && fetchDetailsTable(true);
          fetchDetailsTableGroups && fetchDetailsTableGroups(true);
        } catch (error) {
          console.error('Error fetching data:', error);
        }
      },
    },
  ];
};
